{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center py-5">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow-lg border-0">
            <div class="card-body p-4">
                <div class="text-center mb-4">
                    <h3 class="card-title text-primary mb-2">üîç Domain OSINT Scanner</h3>
                    <p class="text-muted">Analyze domains for MX records and technology stack</p>
                </div>
                
                {% if error %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endif %}
                
                <form method="post" action="{{ url_for('analyze') }}" id="osint-form" novalidate>
                    <div class="row g-3">
                        <div class="col-12">
                            <label for="domain" class="form-label fw-semibold">
                                <i class="fas fa-globe me-1"></i>Domain
                            </label>
                            <input type="text" 
                                   name="domain" 
                                   id="domain" 
                                   class="form-control form-control-lg" 
                                   placeholder="example.com"
                                   pattern="^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}$"
                                   title="Please enter a valid domain (e.g., example.com)" />
                            <div class="invalid-feedback">Please enter a valid domain.</div>
                        </div>
                        
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg px-5" id="analyze-btn">
                            <span class="btn-text">
                                <i class="fas fa-search me-2"></i>Analyze
                            </span>
                            <span class="btn-loading d-none">
                                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                                Analyzing...
                            </span>
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-lg" id="view-json-btn">
                            <i class="fas fa-code me-2"></i>View JSON
                        </button>
                    </div>
                </form>
                
                <div class="mt-4 text-center">
                    <div class="row g-3 justify-content-center">
                        <div class="col-sm-6 col-lg-5">
                            <div class="feature-card p-3">
                                <i class="fas fa-shield-alt text-primary fa-2x mb-2"></i>
                                <h6 class="mb-1">MX Records</h6>
                                <small class="text-muted">Mail exchange configuration</small>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-5">
                            <div class="feature-card p-3">
                                <i class="fas fa-code text-success fa-2x mb-2"></i>
                                <h6 class="mb-1">Tech Stack</h6>
                                <small class="text-muted">BuiltWith integration</small>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                <div class="mt-4 small text-muted text-center">
                    <i class="fas fa-info-circle me-1"></i>
                    API: <code>/analyze?domain=example.com&format=json</code>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <img src="https://cyberdistribution.co.uk/wp-content/uploads/2022/04/keepnet-block.jpg" 
                 alt="Banner" 
                 class="img-fluid" 
                 style="max-height:120px; width:auto; border-radius:8px; opacity:0.9;" />
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('osint-form');
    const analyzeBtn = document.getElementById('analyze-btn');
    const viewJsonBtn = document.getElementById('view-json-btn');
    
    // Form validation
    form.addEventListener('submit', function(e) {
        if (!form.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
        } else {
            // Show loading state
            analyzeBtn.querySelector('.btn-text').classList.add('d-none');
            analyzeBtn.querySelector('.btn-loading').classList.remove('d-none');
            analyzeBtn.disabled = true;
        }
        form.classList.add('was-validated');
    });
    
    // View JSON functionality
    viewJsonBtn.addEventListener('click', function() {
        const domain = document.getElementById('domain').value.trim();
        if (!domain) {
            alert('Please enter a domain first.');
            return;
        }
        const params = new URLSearchParams();
        params.append('domain', domain);
        params.append('format', 'json');
        window.open(`/analyze?${params.toString()}`, '_blank');
    });
    
    // Real-time validation
    const inputs = form.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.checkValidity()) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        });
    });
});
</script>
{% endblock %}